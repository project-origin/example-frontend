
<div class="dialog-header">
    <h1>NEW GGO TRANSFER AGREEMENT</h1>
    <h2>Submit a transfer proposal to a partner</h2>
</div>


<div class="dialog-body">

    <form [formGroup]="form">

        <!-- Direction (inbound/outbound) -->
        <div class="legend">
            <div class="fill-remaining"></div>

            <mat-button-toggle-group formControlName="direction">
                <mat-button-toggle [value]="OUTBOUND">Outbound</mat-button-toggle>
                <div class="space"></div>
                <mat-button-toggle [value]="INBOUND">Inbound</mat-button-toggle>
            </mat-button-toggle-group>

            <div class="fill-remaining"></div>
        </div>


        <!-- Reference ID -->
        <div style="color: red;" *ngFor="let error of submitErrors.reference">- {{ error }}</div>
        <input matInput
            type="text"
            placeholder="Enter subject of your own choosing"
            class="field"
            [class.error]="submitErrors.reference.length > 0"
            (input)="resetErrorsFor('reference')"
            formControlName="reference">
        

        <!-- Counterpart -->
        <div style="color: red;" *ngFor="let error of submitErrors.counterpartId">- {{ error }}</div>

        <div *ngIf="!hasCounterpart()">
            <input 
                matInput type="text"
                placeholder="Enter counterpart name"
                class="field"
                [class.error]="submitErrors.counterpartId.length > 0"
                [matAutocomplete]="auto"
                (input)="resetErrorsFor('counterpartId')"
                formControlName="counterpart">
            
            <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onCounterpartSelected($event)">
                <mat-option *ngFor="let user of (filteredCounterparts | async)" [value]="user">
                    {{ user.company }} ({{ user.name }})
                </mat-option>
            </mat-autocomplete>
        </div>

        <div *ngIf="hasCounterpart()" class="field disabled legend">
            <div>{{ counterpart }}</div>
            <div class="fill-remaining"></div>
            <a mat-button (click)="resetCounterpart()">X</a>
        </div>


        <!-- Technology -->
        <div class="field">
            <mat-select
                formControlName="technology" 
                [placeholder]="loadingFilteringOptions ? 'Loading...' : 'Select energy category (optional)'">

                <mat-option [value]="null">Any</mat-option>
                <mat-option *ngFor="let technology of availableTechnologies" [value]="technology">
                    {{technology}}
                </mat-option>

            </mat-select>
        </div>


        <!-- Facilities -->
        <div class="field" *ngIf="canSelectFacilities">
            <mat-select
                formControlName="facilityIds"
                [placeholder]="loadingFacilities ? 'Loading...' : 'All facilities'"
                multiple>

                <mat-option *ngFor="let facility of availableFacilities" [value]="facility.id">
                    {{facility.name}} ({{facility.gsrn}})
                </mat-option>
            </mat-select>
        </div>


        <!-- Date period -->
        <div style="color: red;" *ngFor="let error of submitErrors.date">- {{ error }}</div>
        <div class="date">
            <input matInput
                class="field value"
                placeholder="Choose a period"
                formControlName="date"
                [class.error]="submitErrors.date.length > 0"
                [satDatepicker]="datePicker"
                (input)="resetErrorsFor('date')"
                (change)="resetErrorsFor('date')"
                [min]="minDate"
                [max]="maxDate">

            <div class="picker" style="display: block;">
                <sat-datepicker #datePicker [rangeMode]="true"></sat-datepicker>
                <sat-datepicker-toggle  [for]="datePicker"></sat-datepicker-toggle>
            </div>
        </div>


        <!-- Amount -->
        <div style="color: red;" *ngFor="let error of submitErrors.amount">- {{ error }}</div>
        <div class="amount">
            <input matInput
                type="text"
                placeholder="Enter max. amount"
                class="field value"
                [class.error]="submitErrors.amount.length > 0"
                (input)="resetErrorsFor('amount')"
                formControlName="amount">
            
            <div class="field unit" [class.disabled]="isDisabled">
                <mat-select formControlName="unit" placeholder="Unit">
                    <mat-option *ngFor="let unit of availableUnits" [value]="unit">
                        {{ unit }}
                    </mat-option>
                </mat-select>
            </div>
        </div>


        <!-- Transfer percentage -->
        <div class="field" [class.disabled]="isDisabled" *ngIf="showAmountPercent">
            <mat-checkbox formControlName="showTransferPercent" (change)="resetErrorsFor('amountPercent')">
                Transfer percentage of GGO's amount
            </mat-checkbox>

            <div style="color: red;" *ngFor="let error of submitErrors.amountPercent">- {{ error }}</div>

            <input matInput
                type="text"
                placeholder="Enter percent (1-100)"
                class="field value"
                [class.error]="submitErrors.amountPercent.length > 0"
                (input)="resetErrorsFor('amountPercent')"
                *ngIf="expandAmountPercent"
                formControlName="amountPercent">
        </div>


        <!-- Limit amount to recipient's consumption -->
        <div style="color: red;" *ngFor="let error of submitErrors.limitToConsumption">- {{ error }}</div>
        <div class="field" [class.disabled]="isDisabled">
            <mat-checkbox formControlName="limitToConsumption">
                Limit transfers to recipient's consumption
            </mat-checkbox>
        </div>


        <div>&nbsp;</div>


        <!-- Buttons -->
        <div class="legend">
            <button mat-button
                type="button"
                class="cancel"
                (click)="closeDialog()">
                CANCEL
            </button>

            <div class="fill-remaining"></div>

            <button mat-button
                type="button"
                class="send"
                [disabled]="submitting"
                (click)="submitProposal()">
                {{ submitting ? 'SENDING..' : 'SUBMIT PROPOSAL' }}
            </button>
        </div>

    </form>

</div>
